{% extends 'base.html' %}
{% load static %}

{% block title %} Post Create {% endblock title %}

{% block content %}
    <div class="px-4 py-2 w-[720px]">

        <div class="mb-4 p-2 flex justify-between border-b">
            <h1 class="text-2xl font-bold">Create Post</h1>
        </div>

        <div class="mb-2">
            <label for="id_editable_title">Title</label>
            <input type="text" id="id_editable_title" class="w-full my-2 p-2 bg-gray-100 dark:bg-gray-900 rounded-md border">
        </div>
            
        <label for="id_editable_content">Content</label>
        <div class="px-4 py-2 my-2 w-full rounded-md border">

            <div class="mb-4 flex justify-center gap-3 flex-wrap">
                <select onchange="formatDoc('formatBlock', this.value); this.selectedIndex=0" class="p-2 rounded-md bg-gray-100 dark:bg-gray-900 border ">
                    <option value="" selected="" hidden="" disabled="">Headings</option>
                    <option value="h1">Heading 1</option>
                    <option value="h2">Heading 2</option>
                    <option value="h3">Heading 3</option>
                    <option value="h4">Heading 4</option>
                    <option value="h5">Heading 5</option>
                    <option value="h6">Heading 6</option>
                    <option value="p">Paragraph</option>
                </select>
                <select onchange="formatDoc('fontSize', this.value); this.selectedIndex=0" class="p-2 rounded-md bg-gray-100 dark:bg-gray-900 border ">
                    <option value="" selected="" hidden="" disabled="">Font size</option>
                    <option value="1">Extra small</option>
                    <option value="2">Small</option>
                    <option value="3">Regular</option>
                    <option value="4">Medium</option>
                    <option value="5">Large</option>
                    <option value="6">Extra large</option>
                </select>

                <div class="p-2 flex items-center rounded-md bg-gray-100 dark:bg-gray-900 border ">
                    <span class="p-1">Color</span>
                    <input type="color" oninput="formatDoc('foreColor', this.value); this.value='#000000'" class="p-1 h-8 w-14 rounded-md bg-gray-100 dark:bg-gray-900">
                </div>
                <div class="p-2 flex items-center rounded-md bg-gray-100 dark:bg-gray-900 border ">
                    <span class="p-1">Background</span>
                    <input type="color" oninput="formatDoc('hiliteColor', this.value); this.value='#000000'" class="p-1 h-8 w-14 rounded-md bg-gray-100 dark:bg-gray-900">
                </div>

                <input type="file" id="imageInput" style="display: none;" accept="image/*" onchange="uploadImage(event)">
                <button class="p-2 rounded-md border" onclick="document.getElementById('imageInput').click()">
                    <i class='bx bx-upload'></i>
                </button>
            </div>

            <div class="mb-4 flex item-center gap-3 flex-wrap">
                <button class="p-2 rounded-md border" onclick="formatDoc('undo')"><i class='bx bx-undo'></i></button>
                <button class="p-2 rounded-md border" onclick="formatDoc('redo')"><i class='bx bx-redo'></i></button>
                <button class="p-2 rounded-md border" onclick="formatDoc('bold')"><i class='bx bx-bold'></i></button>
                <button class="p-2 rounded-md border" onclick="formatDoc('underline')"><i class='bx bx-underline'></i></button>
                <button class="p-2 rounded-md border" onclick="formatDoc('italic')"><i class='bx bx-italic'></i></button>
                <button class="p-2 rounded-md border" onclick="formatDoc('strikeThrough')"><i class='bx bx-strikethrough'></i></button>
                <button class="p-2 rounded-md border" onclick="formatDoc('justifyLeft')"><i class='bx bx-align-left'></i></button>
                <button class="p-2 rounded-md border" onclick="formatDoc('justifyCenter')"><i class='bx bx-align-middle'></i></button>
                <button class="p-2 rounded-md border" onclick="formatDoc('justifyRight')"><i class='bx bx-align-right'></i></button>
                <button class="p-2 rounded-md border" onclick="formatDoc('justifyFull')"><i class='bx bx-align-justify'></i></button>
                <button class="p-2 rounded-md border" onclick="formatDoc('insertOrderedList')"><i class='bx bx-list-ol'></i></button>
                <button class="p-2 rounded-md border" onclick="formatDoc('insertUnorderedList')"><i class='bx bx-list-ul'></i></button>
                <button class="p-2 rounded-md border" onclick="addLink()"><i class='bx bx-link'></i></button>
                <button class="p-2 rounded-md border" onclick="formatDoc('unlink')"><i class='bx bx-unlink'></i></button>
                <button class="p-2 rounded-md border" id="show-code" data-active="false">&lt;/&gt;</button>
            </div>

            <div class="w-full p-2 rounded-md border" 
                id="id_editable_content" 
                contenteditable="true" 
                spellcheck="false">
            </div>
        </div>

        <form action="" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="text" name="title" id="id_title" hidden>
            <textarea name="content" id="id_content" hidden></textarea>
            <div class="mt-4 py-2 border-t">
                <button onclick="submitForm()" class="px-2 py-1 rounded-md text-white bg-blue-500 dark:bg-blue-500">Submit</button>
            </div>
        </form>
            
    </div>

    <script>
        function formatDoc(cmd, value = null) {
            if (value) {
                document.execCommand(cmd, false, value);
            } else {
                document.execCommand(cmd);
            }

            formatLists();
        }
    
        function addLink() {
            const url = prompt('Enter the URL:', '');
            if (url) {
                formatDoc('createLink', url);
            }
        }
    
        const id_editable_content = document.getElementById('id_editable_content');
        const showCode = document.getElementById('show-code');
        let active = false;
    
        // Toggle HTML code view
        showCode.addEventListener('click', function () {
            active = !active;
            showCode.dataset.active = active;
            if (active) {
                id_editable_content.textContent = id_editable_content.innerHTML.trim();
                id_editable_content.setAttribute('contenteditable', false);
            } else {
                id_editable_content.innerHTML = id_editable_content.textContent;
                id_editable_content.setAttribute('contenteditable', true);
            }
        });

        function submitForm() {
            const title = document.getElementById('id_editable_title').value;
            const content = id_editable_content.innerHTML;
            document.getElementById('id_title').value = title;
            document.getElementById('id_content').value = content;
            document.querySelector('form').submit();
        }

        function uploadImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const img = `<img src="${e.target.result}" alt="Uploaded Image" style="max-width: 100%;">`;
                    document.execCommand('insertHTML', false, img);
                };
                reader.readAsDataURL(file);
            }
        }
    </script>

{% endblock content %}
